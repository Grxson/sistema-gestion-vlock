# ๐๏ธ Arquitectura del Mรณdulo de Reportes de Suministros

## Diagrama de Componentes

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      Reportes.jsx                                โ
โ                   (Contenedor Principal)                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                 SuministrosReportsTab.jsx                        โ
โ                  (Componente Principal)                          โ
โ                                                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ         useSuministrosData Hook                          โ   โ
โ  โ  โข dashboardData                                         โ   โ
โ  โ  โข loading, error                                        โ   โ
โ  โ  โข filtros, handleFilterChange                           โ   โ
โ  โ  โข proyectos, proveedores, categorias                    โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                         โ                                         โ
โ                         โผ                                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ              Header + Export Buttons                      โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                         โ                                         โ
โ                         โผ                                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ           SuministrosFilters                              โ  โ
โ  โ  โข Fecha inicio/fin                                       โ  โ
โ  โ  โข Proyecto (select)                                      โ  โ
โ  โ  โข Proveedor (select)                                     โ  โ
โ  โ  โข Categorรญa (select)                                     โ  โ
โ  โ  โข Botรณn limpiar filtros                                  โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                         โ                                         โ
โ                         โผ                                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ         SuministrosStatsCards                             โ  โ
โ  โ  โโโโโโโโ โโโโโโโโ โโโโโโโโ โโโโโโโโ โโโโโโโโ โโโโโโโโ โ  โ
โ  โ  โTotal โ โTotal โ โProveeโ โProyecโ โProme โ โProveeโ โ  โ
โ  โ  โGasta โ โRegis โ โdores โ โtos   โ โdio   โ โdor   โ โ  โ
โ  โ  โdo    โ โtros  โ โ      โ โ      โ โGasto โ โPrinc โ โ  โ
โ  โ  โโโโโโโโ โโโโโโโโ โโโโโโโโ โโโโโโโโ โโโโโโโโ โโโโโโโโ โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                         โ                                         โ
โ                         โผ                                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ           SuministrosCharts                               โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโ       โ  โ
โ  โ  โ  Costo por Proyecto โ  โ  Distribuciรณn por   โ       โ  โ
โ  โ  โ     (Bar Chart)     โ  โ  Proveedores (Dona) โ       โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโ       โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโ       โ  โ
โ  โ  โ Evoluciรณn Mensual   โ  โ  Distribuciรณn por   โ       โ  โ
โ  โ  โ   (Line Chart)      โ  โ  Categorรญas (Pie)   โ       โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโ       โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                         โ                                         โ
โ                         โผ                                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ           SuministrosTable                                โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ  โ
โ  โ  โ Material โ Categorรญa โ Frecuencia โ Cantidad โ $   โ โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค โ  โ
โ  โ  โ ...      โ ...       โ ...        โ ...      โ ... โ โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ  โ
โ  โ  โข Ordenamiento por columnas                             โ  โ
โ  โ  โข Paginaciรณn (10 items/pรกgina)                          โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                         โ                                         โ
โ                         โผ                                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ         SuministrosExport (Floating)                      โ  โ
โ  โ  [PDF] [Excel] [Personalizado]                           โ  โ
โ  โ                                                            โ  โ
โ  โ  Modal de Configuraciรณn:                                  โ  โ
โ  โ  โข Tรญtulo y subtรญtulo                                     โ  โ
โ  โ  โข Incluir filtros                                        โ  โ
โ  โ  โข Incluir estadรญsticas                                   โ  โ
โ  โ  โข Selecciรณn de grรกficos                                  โ  โ
โ  โ  โข Incluir tabla                                          โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Flujo de Datos

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        INICIO                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              useSuministrosData Hook                              โ
โ                    (useEffect inicial)                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
         โโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโ
         โ                               โ
         โผ                               โผ
โโโโโโโโโโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโโโโโโโโโ
โ cargarDatosInicialesโ      โ  cargarDashboard    โ
โ  โข getProyectos()   โ      โ  โข getDashboard     โ
โ  โข getProveedores() โ      โ    Suministros()    โ
โ  โข setCategorias()  โ      โ                     โ
โโโโโโโโโโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโโโโโโโโโ
         โ                               โ
         โโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   Estado Actualizado                              โ
โ  โข dashboardData                                                  โ
โ  โข proyectos, proveedores, categorias                             โ
โ  โข loading = false                                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              Componentes se Renderizan                            โ
โ  โข SuministrosFilters (recibe proyectos, proveedores, etc.)      โ
โ  โข SuministrosStatsCards (recibe estadisticas)                   โ
โ  โข SuministrosCharts (recibe dashboardData)                      โ
โ  โข SuministrosTable (recibe materiales)                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              Usuario Interactรบa                                   โ
โ  โข Cambia filtros                                                 โ
โ  โข Ordena tabla                                                   โ
โ  โข Exporta reporte                                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
         โโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโ
         โ                               โ
         โผ                               โผ
โโโโโโโโโโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโโโโโโโโโ
โ  handleFilterChange โ      โ  Otras acciones     โ
โ  (en hook)          โ      โ  (locales)          โ
โโโโโโโโโโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  Debounce 500ms     โ
โโโโโโโโโโโโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  cargarDashboard    โ
โ  (con nuevos filtros)โ
โโโโโโโโโโโโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              Componentes se Re-renderizan                         โ
โ              con Nuevos Datos                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Flujo de Exportaciรณn

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ            Usuario Click en Botรณn de Exportaciรณn                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
         โโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโ
         โ                               โ
         โผ                               โผ
โโโโโโโโโโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโโโโโโโโโ
โ  Exportaciรณn Rรกpida โ      โ  Exportaciรณn        โ
โ  โข PDF              โ      โ  Personalizada      โ
โ  โข Excel            โ      โ  โข Abre Modal       โ
โโโโโโโโโโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโโโโโโโโโ
         โ                               โ
         โ                               โผ
         โ                   โโโโโโโโโโโโโโโโโโโโโโโ
         โ                   โ Usuario Configura:  โ
         โ                   โ โข Tรญtulo            โ
         โ                   โ โข Contenido         โ
         โ                   โ โข Grรกficos          โ
         โ                   โโโโโโโโโโโโโโโโโโโโโโโ
         โ                               โ
         โโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              API Call a Backend                                   โ
โ  โข exportDashboardSuministrosToPDF()                             โ
โ  โข exportDashboardSuministrosToExcel()                           โ
โ  โข exportDashboardCustomToPDF()                                  โ
โ  โข exportDashboardCustomToExcel()                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              Backend Genera Archivo                               โ
โ  โข Procesa datos                                                  โ
โ  โข Genera PDF/Excel                                               โ
โ  โข Retorna Blob                                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              Frontend Descarga Archivo                            โ
โ  โข Crea URL temporal                                              โ
โ  โข Crea elemento <a>                                              โ
โ  โข Trigger download                                               โ
โ  โข Limpia recursos                                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Responsabilidades por Componente

### **SuministrosReportsTab**
- โ Orquestar todos los subcomponentes
- โ Gestionar estado global con hook
- โ Manejar estados de carga y error
- โ Proporcionar layout y estructura

### **useSuministrosData**
- โ Cargar datos iniciales
- โ Gestionar filtros con debounce
- โ Hacer llamadas a API
- โ Manejar errores y fallbacks
- โ Proporcionar funciones de actualizaciรณn

### **SuministrosStatsCards**
- โ Mostrar mรฉtricas clave
- โ Formatear valores (moneda, nรบmeros)
- โ Diseรฑo visual atractivo
- โ Responsive grid

### **SuministrosFilters**
- โ Renderizar controles de filtro
- โ Validar entradas
- โ Comunicar cambios al padre
- โ Mostrar indicadores de filtros activos

### **SuministrosCharts**
- โ Configurar grรกficas de Chart.js
- โ Procesar datos para visualizaciรณn
- โ Manejar estados vacรญos
- โ Proporcionar tooltips personalizados

### **SuministrosTable**
- โ Renderizar tabla de datos
- โ Implementar ordenamiento
- โ Implementar paginaciรณn
- โ Formatear valores de celdas

### **SuministrosExport**
- โ Proporcionar botones de exportaciรณn
- โ Gestionar modal de configuraciรณn
- โ Hacer llamadas a API de exportaciรณn
- โ Manejar descarga de archivos

---

## Patrones de Diseรฑo Utilizados

### 1. **Container/Presentational Pattern**
- **Container:** `SuministrosReportsTab` (lรณgica)
- **Presentational:** Componentes en `/suministros` (UI)

### 2. **Custom Hook Pattern**
- `useSuministrosData` encapsula lรณgica de datos
- Reutilizable en otros contextos
- Separaciรณn de concerns

### 3. **Compound Components**
- Componentes trabajan juntos pero son independientes
- Cada uno tiene responsabilidad รบnica
- Fรกcil composiciรณn

### 4. **Render Props (implรญcito)**
- Componentes reciben datos como props
- No manejan lรณgica de negocio
- Fรกcil testing

### 5. **Barrel Export Pattern**
- `index.js` centraliza exports
- Importaciones limpias
- Mejor organizaciรณn

---

## Principios SOLID Aplicados

### **S - Single Responsibility**
โ Cada componente tiene una responsabilidad รบnica
- StatsCards: Solo mostrar mรฉtricas
- Filters: Solo gestionar filtros
- Charts: Solo visualizar datos
- Table: Solo mostrar tabla
- Export: Solo exportar

### **O - Open/Closed**
โ Componentes abiertos a extensiรณn, cerrados a modificaciรณn
- Fรกcil agregar nuevas mรฉtricas sin cambiar StatsCards
- Fรกcil agregar nuevas grรกficas sin cambiar Charts

### **L - Liskov Substitution**
โ Componentes intercambiables
- Cualquier componente de grรกfica puede reemplazar a otro
- Props consistentes

### **I - Interface Segregation**
โ Props especรญficas por componente
- Componentes no reciben props innecesarias
- Interfaces mรญnimas y claras

### **D - Dependency Inversion**
โ Componentes dependen de abstracciones
- Hook proporciona interfaz abstracta
- Componentes no conocen implementaciรณn de API

---

## Performance Optimizations

### 1. **Debouncing**
```javascript
// En useSuministrosData
useEffect(() => {
  const timeoutId = setTimeout(() => {
    cargarDashboard();
  }, 500);
  return () => clearTimeout(timeoutId);
}, [cargarDashboard]);
```

### 2. **Memoization**
```javascript
// En SuministrosTable
const sortedMateriales = React.useMemo(() => {
  // ... lรณgica de ordenamiento
}, [materiales, sortConfig]);
```

### 3. **Lazy Loading**
- Componentes se cargan solo cuando se necesitan
- Grรกficas se renderizan solo si hay datos

### 4. **Conditional Rendering**
```javascript
{chartConsumoProyecto ? (
  <Bar data={chartConsumoProyecto} />
) : (
  <EmptyState />
)}
```

---

## Testing Strategy

### Unit Tests
```javascript
// Ejemplo para SuministrosStatsCards
describe('SuministrosStatsCards', () => {
  it('renders all 6 metric cards', () => {
    // ...
  });
  
  it('formats currency correctly', () => {
    // ...
  });
  
  it('handles missing data gracefully', () => {
    // ...
  });
});
```

### Integration Tests
```javascript
// Ejemplo para SuministrosReportsTab
describe('SuministrosReportsTab', () => {
  it('loads data on mount', () => {
    // ...
  });
  
  it('updates charts when filters change', () => {
    // ...
  });
  
  it('handles API errors', () => {
    // ...
  });
});
```

### E2E Tests
```javascript
// Ejemplo con Playwright/Cypress
describe('Suministros Reports', () => {
  it('allows user to filter and export report', () => {
    // 1. Navigate to reports
    // 2. Apply filters
    // 3. Verify charts update
    // 4. Click export
    // 5. Verify download
  });
});
```

---

## Conclusiรณn

Esta arquitectura modular proporciona:
- โ Cรณdigo mantenible y escalable
- โ Componentes reutilizables
- โ Separaciรณn clara de responsabilidades
- โ Performance optimizado
- โ Fรกcil testing
- โ Documentaciรณn completa
- โ Preparado para crecimiento futuro
